<!doctype html>
<html>
<style>
.slidecontainer {
    width: 100%;
}

.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 25px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
}

.slider:hover {
    opacity: 1;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 25px;
    height: 25px;
    background: #4CAF50;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 25px;
    height: 25px;
    background: #4CAF50;
    cursor: pointer;
}

.container{
    display: flex;
    flex-wrap: wrap;
}

.left-float{
    flex-grow: 1;
    flex-basis: auto;
    max-width: 275px;
}
.flex-item{
    flex-grow: 3;
    padding: 20px;
}
</style>
<head>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<title>Item Level Effects</title>
</head>

<body>
  <div id="header">Generate some random data to see if item level effects matter in what you study!</div>
  <div id="header">First, estimate some information about the stimuli you use.</div>
  <div class="container">
    <div class="left-float" id="slider1">
      <p>What's your hypothetical effect size? <span id="eelement"></span></p>
      <input type="range" min="0" max="5" value="1" class="slider" id="eslider" step="0.1">
          <p>How variable are responses to class 1? <span id="i1element"></span></p>
      <input type="range" min="0.1" max="5" value="1" class="slider" id="i1slider" step="0.1">
        <p>How variable are responses to class 2? <span id="i2element"></span></p>
      <input type="range" min="0.1" max="5" value="1" class="slider" id="i2slider" step="0.1">
    </div>
  <div class="flex-item" id="itemline"></div>
</div>
<div id="header">Now, we'll pick stimuli and run an experiment.</div>
<div class="container">
    <div class="left-float" id="slider1">
      <p>Items per class: <span id="nselement"></span></p>
      <input type="range" min="0" max="100" value="0" class="slider" id="nsslider" step="1">
      <p>Number of subjects: <span id="nielement"></span></p>
      <input type="range" min="0" max="100" value="0" class="slider" id="nislider" step="1">
      <p>Standard deviation of subjects: <span id="selement"></span></p>
        <input type="range" min="0.1" max="5" value="1" class="slider" id="sslider" step="0.1">
    </div>
</div>

<script>
var nislider = document.getElementById("nislider");
var nielement = document.getElementById("nielement");
nielement.innerHTML = nislider.value;
var nsslider = document.getElementById("nsslider");
var nselement = document.getElementById("nselement");
nselement.innerHTML = nsslider.value;
var eslider = document.getElementById("eslider");
var eelement = document.getElementById("eelement");
eelement.innerHTML = eslider.value;
var sslider = document.getElementById("sslider");
var selement = document.getElementById("selement");
selement.innerHTML = sslider.value;
var i1slider = document.getElementById("i1slider");
var i1element = document.getElementById("i1element");
i1element.innerHTML =i1slider.value;
var i2slider = document.getElementById("i2slider");
var i2element = document.getElementById("i2element");
i2element.innerHTML =i2slider.value;
nislider.oninput = function() {
  nielement.innerHTML = this.value;
}
nsslider.oninput = function() {
  nselement.innerHTML = this.value;
}
eslider.oninput = function() {
  eelement.innerHTML = this.value;
}
eslider.onchange = replot_itmes
sslider.oninput = function() {
  selement.innerHTML = this.value;
}
i1slider.oninput = function() {
  i1element.innerHTML = this.value;
}
i1slider.onchange = replot_itmes

i2slider.oninput = function() {
  i2element.innerHTML = this.value;
}
i2slider.onchange = replot_itmes


Math.nrand = function() {
    var x1, x2, rad, y1;
    do {
        x1 = 2 * this.random() - 1;
        x2 = 2 * this.random() - 1;
        rad = x1 * x1 + x2 * x2;
    } while(rad >= 1 || rad == 0);
    var c = this.sqrt(-2 * Math.log(rad) / rad);
    return x1 * c;
};

function gen_range(minVal, maxVal, nVals){
    var vals = [...Array(nVals).keys()];
    for (var i = 0; i < vals.length; i++) {
        vals[i] = (vals[i]/((vals.length -1)) * (maxVal-minVal)) + minVal;
        };
    return vals
    };
function gen_norm_plot_data(vals, mean, stdDev){
    data = []
    for (var i = 0; i < vals.length; i++) {
        norm_val = Math.exp((-0.5) * Math.pow((vals[i] - mean) / stdDev, 2))/Math.sqrt(2 * Math.PI * stdDev);
        data.push({x: vals[i],
                   y: norm_val})
        }
    return data
    };
var item_lines = lines()
              .$el(d3.select("#itemline"))
              .height(100) // Set height
              .data1(get_data(0,
                             parseFloat(i1slider.value))) // Set data for line 1
              .data2(get_data(parseFloat(eslider.value),
                              parseFloat(i2slider.value))) // Set data for line 2
              .render();
function replot_itmes(){
    item_lines
        .data1(get_data(0,
                         parseFloat(i1slider.value))) // Set data for line 1
          .data2(get_data(
                         parseFloat(eslider.value),
                         parseFloat(i2slider.value))) // Set data for line 2
          .render()};
function get_data(fixed, item_re){
    var use_pxs = gen_range((-4 * item_re )+fixed,(4 * item_re) + fixed,10000);
    console.log(use_pxs)
    console.log(fixed)
    item_pd = gen_norm_plot_data(use_pxs, fixed, item_re);
    return item_pd
}
function lines(){
  // Default settings
  var $el = d3.select("body")
  var width = 400;
  var height = 600;
  var color1 = "#2c6bd2";
  var color2 = "#4c8d24";
  var margin = {top: 10, right: 30, bottom: 30, left: 50};
  var data1 = [];
  var data2 = [];
  var svg, y, xAxis, yAxis, line;
  var x = d3.scaleLinear().range([0, width]);

  var object = {};

  // Method for render/refresh graph
  object.render = function(){
    if(!svg){ 
      // Render first time
      y = d3.scaleLinear()
      .range([height, 0]);

      xAxis = d3.axisBottom()
      .scale(x);

      yAxis = d3.axisLeft()
        .scale(y);

      line = d3.line()
        .x(function(d) { return x(d.x); })
        .y(function(d) { return y(d.y); })
        .curve(d3.curveBasis);

      svg = $el.append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      x.domain([d3.min( 
                  [d3.min(data1, function(d) { return d.x; }),
                   d3.min(data2, function(d) { return d.x; })]
                  ),
                d3.max(
                  [d3.max(data1, function(d) { return d.x; }),
                   d3.max(data2, function(d) { return d.x; })])
                ]);
      y.domain([0,
                d3.max(
                  [d3.max(data1, function(d) { return d.y; }),
                   d3.max(data2, function(d) { return d.y; })])
                ]);

      svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

      //x axis label
      svg.append("text")             
      .attr("transform",
            "translate(" + (width/2) + " ," + 
                           (height + margin.top + 20) + ")")
      .style("text-anchor", "middle")
      .text("Normalized Response");

      svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - margin.left)
        .attr("x",0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Density");      

      svg.append("path")
        .datum(data1)
        .attr("class", "line1")
        .attr("stroke", color1)
        .attr("fill", color1)
        .attr("fill-opacity", 0.5)
        .attr("d", line);

      svg.append("path")
        .datum(data2)
        .attr("class", "line2")
        .attr("stroke", color2)
        .attr("fill", color2)
        .attr("fill-opacity", 0.5)
        .attr("d", line);
    }else{ //Refresh
      object.data1(data1);
      object.data2(data2);
      x.domain([d3.min( 
                  [d3.min(data1, function(d) { return d.x; }),
                   d3.min(data2, function(d) { return d.x; })]
                  ),
                d3.max(
                  [d3.max(data1, function(d) { return d.x; }),
                   d3.max(data2, function(d) { return d.x; })])
                ]);
      y.domain([0,
                d3.max(
                  [d3.max(data1, function(d) { return d.y; }),
                   d3.max(data2, function(d) { return d.y; })])
                ]);

      svg.select("g.y")
        .transition()
        .duration(1000)
        .call(yAxis);

      svg.select("g.x")
        .transition()
        .duration(1000)
        .call(xAxis);

      svg.selectAll("path.line1")
       .datum(data1)
        .transition()
        .duration(1000)
       .attr("d", line);
      svg.selectAll("path.line2")
       .datum(data2)
        .transition()
        .duration(1000)
       .attr("d", line);
    } 
    return object;
  };

  // Getter and setter methods
  object.data1 = function(value){
    if (!arguments.length) return data1;
    data1 = value;
    return object;
  };
  object.data2 = function(value){
    if (!arguments.length) return data2;
    data2 = value;
    return object;
  };

  object.$el = function(value){
    if (!arguments.length) return $el;
    $el = value;
    return object;
  };

  object.width = function(value){
    if (!arguments.length) return width;
    width = value;
    return object;
  };

  object.height = function(value){
    if (!arguments.length) return height;
    height = value;
    return object;
  };

  object.color = function(value){
    if (!arguments.length) return color;
    color = value;
    return object;
  };
  object.x = function(value){
    if (!arguments.length) return x;
    x = value;
    return object;
  }
  return object;
};
</script>
</body>
</html>